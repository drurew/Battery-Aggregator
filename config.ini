# BMS Aggregator Configuration File
# 
# This file allows you to customize the behavior of the battery aggregator
# without modifying the Python code. All values can be adjusted to match
# your specific battery setup and requirements.
#
# After making changes, restart the service:
#   svc -t /service/bms-aggregator

[Battery]
# Total battery capacity in Ah
# For parallel batteries, this is the sum of all capacities
# Example: 3x 150Ah batteries = 450Ah
capacity = 450.0

# Maximum charge voltage in volts
# LiFePO4 typical: 14.2V - 14.6V
# Lead-acid typical: 14.4V - 14.8V
max_charge_voltage = 14.2

# Maximum discharge current in amps
# This is the continuous discharge rating of your battery bank
max_discharge_current = 150.0

# Battery low voltage cutoff in volts
# LiFePO4 typical: 11.5V - 12.0V
# Lead-acid typical: 10.5V - 11.5V
battery_low_voltage = 11.5

[ChargeLimits]
# Nominal (full speed) charge current in amps
# This is used when batteries are well-balanced (<5% SOC difference)
nominal_charge_current = 150.0

# Reduced charge current for severe imbalance in amps
# This is used when imbalance exceeds alarm threshold
reduced_charge_current = 50.0

[ImbalanceThresholds]
# SOC difference thresholds (in percentage points)
# These define when the aggregator takes protective action
#
# IMPORTANT: If one of your batteries charges/discharges at a different
# rate than the others, you may need to increase these thresholds to
# avoid constant warnings. Recommended starting values for mismatched
# battery characteristics: ok=8, warning=15, alarm=20

# OK threshold - minor difference, still uses 85% charge current
# Below this value: full nominal_charge_current
# Above this value: 85% of nominal_charge_current
imbalance_ok_threshold = 5.0

# Warning threshold - moderate difference, reduces to 66% charge current
# Above this value: triggers Warning alarm, uses 66% of nominal_charge_current
imbalance_warning_threshold = 15.0

# Alarm threshold - severe difference, uses reduced_charge_current
# Above this value: triggers Alarm, uses reduced_charge_current (typically 33%)
imbalance_alarm_threshold = 20.0

[BMS]
# BMS service names on the D-Bus
# These are the Victron service names for your individual BMS units
# Use 'dbus -y' command to list available services
bms1_service = com.victronenergy.battery.canopen_bms_node1
bms2_service = com.victronenergy.battery.canopen_bms_node2
bms3_service = com.victronenergy.battery.canopen_bms_node3

# Device instance for the aggregator service
# This must be unique and not conflict with other battery services
# Typically in the range 280-289
device_instance = 280

[Logging]
# Update interval in seconds
# How often the aggregator reads BMS data and updates D-Bus
# Lower values = more responsive, higher CPU usage
# Typical range: 1-5 seconds
update_interval = 2.0

# Enable verbose debug logging
# Set to true for detailed logging (useful for troubleshooting)
# Set to false for normal operation (less log output)
debug = false
